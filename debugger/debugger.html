<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node.js Debugger</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <h1>Node.js Debugger</h1>
        <div class="status">
            <div class="status-indicator" id="statusIndicator"></div>
            <span id="statusText">Disconnected</span>
        </div>
    </div>

    <!-- Compact Dockable Toolbar -->
    <div class="toolbar" id="toolbar" data-icon-size="medium">
        <div class="toolbar-grip" id="toolbarGrip" title="Drag to dock">‚ãÆ‚ãÆ</div>

        <!-- Connection Controls -->
        <div id="connectionControls" class="toolbar-group">
            <input type="text" id="wsUrl" class="toolbar-input" value="ws://localhost:8888" placeholder="ws://localhost:8888" title="WebSocket URL">
            <button class="toolbar-btn success" id="connectBtn">
                <span class="btn-icon">üîå</span>
                <span class="btn-label">Connect</span>
            </button>
        </div>

        <!-- Debug Controls -->
        <div id="debugControls" class="toolbar-group" style="display: none;">
            <button class="toolbar-btn" id="pauseBtn">
                <span class="btn-icon">‚è∏</span>
                <span class="btn-label">Pause</span>
            </button>
            <button class="toolbar-btn" id="resumeBtn" disabled>
                <span class="btn-icon">‚ñ∂</span>
                <span class="btn-label">Resume</span>
            </button>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn" id="stepOverBtn" disabled>
                <span class="btn-icon">‚§µ</span>
                <span class="btn-label">Over</span>
            </button>
            <button class="toolbar-btn" id="stepIntoBtn" disabled>
                <span class="btn-icon">‚§ì</span>
                <span class="btn-label">Into</span>
            </button>
            <button class="toolbar-btn" id="stepOutBtn" disabled>
                <span class="btn-icon">‚§í</span>
                <span class="btn-label">Out</span>
            </button>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn danger" id="disconnectBtn">
                <span class="btn-icon">‚úó</span>
                <span class="btn-label">Disconnect</span>
            </button>
        </div>

        <!-- Settings Controls -->
        <div class="toolbar-group toolbar-settings">
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn small" id="toolbarRedockBtn" title="Dock toolbar above tabs" style="display: none;">
                <span class="btn-icon">‚á≤</span>
            </button>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn small" id="settingsBtn" title="Settings">
                <span class="btn-icon">‚öôÔ∏è</span>
            </button>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel" style="display: none;">
        <div class="settings-header">Icon Size</div>
        <div class="settings-options">
            <button class="settings-option-btn" id="iconSizeSmall" data-size="small">
                <span class="btn-icon">S</span>
                <span class="btn-label">Small</span>
            </button>
            <button class="settings-option-btn" id="iconSizeMedium" data-size="medium">
                <span class="btn-icon">M</span>
                <span class="btn-label">Medium</span>
            </button>
            <button class="settings-option-btn" id="iconSizeLarge" data-size="large">
                <span class="btn-icon">L</span>
                <span class="btn-label">Large</span>
            </button>
        </div>
    </div>

    <div class="content" id="content">
        <!-- Toolbar Docking Zone -->
        <div class="toolbar-dock-zone" id="toolbarDockZone"></div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="console">Console</button>
            <button class="tab-btn" data-tab="callstack">Call Stack</button>
            <button class="tab-btn" data-tab="files">Files</button>
            <button class="tab-btn" data-tab="breakpoints">Breakpoints</button>
            <button class="tab-btn" data-tab="watches">Watches</button>
            <button class="tab-btn" data-tab="scope">Scope</button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Console Tab -->
            <div class="tab-pane active" id="tab-console">
                <div class="console-redock-placeholder">
                    <button class="console-redock-large-btn" id="consoleRedockLargeBtn" title="Re-dock console to this tab">
                        <span class="redock-icon">‚á≤</span>
                        <span class="redock-label">Re-dock Console</span>
                    </button>
                </div>
                <div class="console-container">
                    <div class="console-search-wrapper collapsed">
                        <button class="console-search-toggle" id="consoleSearchToggle" title="Toggle search">üîç</button>
                        <div class="console-search">
                            <input type="text" id="consoleSearchInput" class="search-input" placeholder="Search console...">
                            <label class="search-option">
                                <input type="checkbox" id="consoleSearchRegex"> Regex
                            </label>
                            <button id="consoleClearSearch" class="search-clear-btn" title="Clear search">‚úï</button>
                        </div>
                    </div>
                    <div class="console-controls">
                        <button class="console-control-btn" id="consoleUndockBtn" title="Undock console">‚á±</button>
                    </div>
                    <div id="debugLog" class="console-content">
                        <div class="empty-state">No console output</div>
                    </div>
                </div>
            </div>

            <!-- Call Stack Tab -->
            <div class="tab-pane" id="tab-callstack">
                <div id="callstack">
                    <div class="empty-state">Pause execution to see call stack</div>
                </div>
            </div>

            <!-- Files Tab -->
            <div class="tab-pane" id="tab-files">
                <div id="fileTree">
                    <div class="tree-node">
                        <div class="tree-node-header" onclick="toggleTreeNode(this)">
                            <span class="tree-icon">‚ñ∂</span>
                            <span class="tree-label">üìÅ Project Files</span>
                        </div>
                        <div class="tree-children" id="projectFiles"></div>
                    </div>
                    <div class="tree-node">
                        <div class="tree-node-header" onclick="toggleTreeNode(this)">
                            <span class="tree-icon">‚ñ∂</span>
                            <span class="tree-label">üìö Libraries</span>
                        </div>
                        <div class="tree-children">
                            <div class="tree-node">
                                <div class="tree-node-header" onclick="toggleTreeNode(this)">
                                    <span class="tree-icon">‚ñ∂</span>
                                    <span class="tree-label">üì¶ Dependencies</span>
                                </div>
                                <div class="tree-children" id="dependencies"></div>
                            </div>
                            <div class="tree-node">
                                <div class="tree-node-header" onclick="toggleTreeNode(this)">
                                    <span class="tree-icon">‚ñ∂</span>
                                    <span class="tree-label">üîß Dev Dependencies</span>
                                </div>
                                <div class="tree-children" id="devDependencies"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tree-node">
                        <div class="tree-node-header" onclick="toggleTreeNode(this)">
                            <span class="tree-icon">‚ñ∂</span>
                            <span class="tree-label">‚öôÔ∏è Node Internal</span>
                        </div>
                        <div class="tree-children" id="nodeInternalFiles"></div>
                    </div>
                </div>
            </div>

            <!-- Breakpoints Tab -->
            <div class="tab-pane" id="tab-breakpoints">
                <div id="breakpointsList">
                    <div class="empty-state">No breakpoints set</div>
                </div>
            </div>

            <!-- Watches Tab -->
            <div class="tab-pane" id="tab-watches">
                <div id="watchesList">
                    <div class="empty-state">No watches added</div>
                </div>
                <div class="add-watch-form">
                    <input type="text" class="add-watch-input" id="watchInput" placeholder="Expression to watch">
                    <button class="add-watch-btn" id="addWatchBtn">Add</button>
                </div>
            </div>

            <!-- Scope Tab -->
            <div class="tab-pane" id="tab-scope">
                <div id="scopeVariables">
                    <div class="empty-state">No scope information available</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dockable Console Panel -->
    <div class="console-dock docked" id="consoleDock" style="display: none;">
        <div class="console-dock-header" id="consoleDockGrip">
            <span class="console-dock-title">üìú Console</span>
            <div class="console-dock-controls">
                <button class="console-dock-btn" id="consoleRedockBtn" title="Re-dock to tab panel">‚á≤</button>
            </div>
        </div>
        <div class="console-search-wrapper collapsed">
            <button class="console-search-toggle" id="consoleSearchToggleDock" title="Toggle search">üîç</button>
            <div class="console-search">
                <input type="text" id="consoleSearchInputDock" class="search-input" placeholder="Search console...">
                <label class="search-option">
                    <input type="checkbox" id="consoleSearchRegexDock"> Regex
                </label>
                <button id="consoleClearSearchDock" class="search-clear-btn" title="Clear search">‚úï</button>
            </div>
        </div>
        <div id="debugLogDock" class="console-dock-content">
            <!-- Same content as debugLog, synced -->
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script src="../client/inspector-constants.js"></script>
    <script src="../client/regex-pubsub.js"></script>
    <script src="../client/websocket-protocol-event-queue.js"></script>
    <script src="../client/inspector-controllers.js"></script>
    <script src="../client/inspector-factory.js"></script>
    <script src="../client/inspector-browser-client.js"></script>
    <script src="./main.js"></script>
</body>
</html>
